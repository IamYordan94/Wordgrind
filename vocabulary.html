<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Vocabulary Database - Progressive Word Grind</title>
    <meta name="description" content="View your complete vocabulary collection from Progressive Word Grind. Track your learning progress and review all discovered words with definitions.">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#6aaa64">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 10px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            position: relative;
        }

        .nav-links {
            position: absolute;
            left: 0;
            top: 30px;
            display: flex;
            gap: 15px;
        }

        .nav-link {
            background: #444;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 14px;
        }

        .nav-link:hover {
            background: #555;
        }

        h1 {
            font-size: 2.8em;
            background: linear-gradient(45deg, #6aaa64, #c9b458);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .description {
            color: #e0e0e0;
            font-size: 1.1em;
            max-width: 600px;
            margin: 0 auto 30px auto;
        }

        .stats-section {
            background: rgba(106, 170, 100, 0.1);
            border: 2px solid #6aaa64;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 40px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #6aaa64;
            display: block;
        }

        .stat-label {
            color: #ccc;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .level-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #6aaa64;
        }

        .level-title {
            color: #6aaa64;
            font-size: 1.8em;
            margin: 0;
        }

        .level-count {
            background: #6aaa64;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .words-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .word-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .word-card:hover {
            background: rgba(106, 170, 100, 0.2);
            border-color: #6aaa64;
            transform: translateY(-3px);
        }

        .word-text {
            font-size: 1.3em;
            font-weight: bold;
            color: #fff;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .word-pos {
            color: #c9b458;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .word-definition {
            color: #ccc;
            font-size: 0.85em;
            line-height: 1.4;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-state h3 {
            color: #6aaa64;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .start-playing-btn {
            background: linear-gradient(45deg, #6aaa64, #5a9954);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .start-playing-btn:hover {
            background: linear-gradient(45deg, #5a9954, #4a8944);
            transform: translateY(-2px);
        }

        .search-section {
            background: rgba(201, 180, 88, 0.1);
            border: 1px solid #c9b458;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }

        .search-input:focus {
            outline: none;
            border-color: #c9b458;
            background: rgba(255, 255, 255, 0.15);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn {
            background: #444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .filter-btn:hover {
            background: #555;
        }

        .filter-btn.active {
            background: #c9b458;
            color: #1a1a1a;
        }

        .definition-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: #2a2a2a;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            color: white;
            position: relative;
            border: 2px solid #6aaa64;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #ccc;
        }

        .close-modal:hover {
            color: white;
        }

        .modal-word {
            font-size: 2.5em;
            color: #6aaa64;
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .modal-pos {
            background: rgba(201, 180, 88, 0.3);
            color: #c9b458;
            padding: 5px 15px;
            border-radius: 15px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .modal-definition {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .grammar-explanation {
            background: rgba(106, 170, 100, 0.1);
            border-left: 4px solid #6aaa64;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
        }

        .grammar-explanation h4 {
            color: #6aaa64;
            margin-bottom: 8px;
        }

        /* Tier Badge Styles */
        .tier-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .tier-badge.free {
            background: rgba(150, 150, 150, 0.2);
            border: 2px solid #888;
            color: #ccc;
        }

        .tier-badge.paid {
            background: rgba(106, 170, 100, 0.2);
            border: 2px solid #6aaa64;
            color: #6aaa64;
        }

        .tier-badge.lifetime {
            background: rgba(212, 169, 83, 0.2);
            border: 2px solid #d4a953;
            color: #d4a953;
        }

        /* Word Count Display */
        .word-count-info {
            text-align: center;
            padding: 15px;
            background: rgba(106, 170, 100, 0.1);
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .word-count-number {
            color: #6aaa64;
            font-weight: bold;
            font-size: 1.3em;
        }

        /* Upgrade Banner for Free Users */
        .upgrade-banner {
            background: linear-gradient(135deg, rgba(212, 169, 83, 0.15) 0%, rgba(106, 170, 100, 0.15) 100%);
            border: 2px solid #d4a953;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }

        .upgrade-banner h3 {
            color: #d4a953;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .upgrade-banner p {
            color: #e0e0e0;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .upgrade-btn {
            background: linear-gradient(135deg, #d4a953 0%, #c49943 100%);
            color: #1a1a1a;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .upgrade-btn:hover {
            background: linear-gradient(135deg, #e4b963 0%, #d4a953 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 169, 83, 0.4);
        }

        /* Premium Feature Buttons */
        .premium-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .premium-btn {
            background: #6aaa64;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .premium-btn:hover {
            background: #5a9954;
            transform: translateY(-2px);
        }

        .premium-btn.disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .premium-btn.disabled:hover {
            transform: none;
            background: #555;
        }

        /* Word Notes */
        .word-notes {
            background: rgba(201, 180, 88, 0.1);
            border-left: 3px solid #c9b458;
            padding: 10px;
            margin-top: 10px;
            border-radius: 0 5px 5px 0;
            font-size: 0.9em;
            font-style: italic;
            color: #e0e0e0;
        }

        .add-note-btn {
            background: rgba(201, 180, 88, 0.2);
            color: #c9b458;
            border: 1px solid #c9b458;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.3s ease;
        }

        .add-note-btn:hover {
            background: rgba(201, 180, 88, 0.3);
        }

        /* Lifetime Progress Display */
        .lifetime-progress {
            background: rgba(212, 169, 83, 0.1);
            border: 2px solid #d4a953;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .lifetime-progress h3 {
            color: #d4a953;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .progress-bar-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 30px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .progress-bar-fill {
            background: linear-gradient(90deg, #6aaa64 0%, #d4a953 100%);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .progress-text {
            color: #e0e0e0;
            font-size: 1.1em;
        }

        /* Advanced Filter Options (Premium) */
        .advanced-filters {
            background: rgba(106, 170, 100, 0.05);
            border: 1px solid rgba(106, 170, 100, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .advanced-filters h4 {
            color: #6aaa64;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .sort-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .sort-btn {
            background: #444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .sort-btn:hover {
            background: #555;
        }

        .sort-btn.active {
            background: #6aaa64;
            color: white;
        }

        /* Free Tier Word Limit Indicator */
        .word-card.limit-indicator {
            position: relative;
            opacity: 0.6;
        }

        .word-card.limit-indicator::after {
            content: 'üîí';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }

            h1 {
                font-size: 2.2em;
            }

            .nav-links {
                position: static;
                justify-content: center;
                margin-bottom: 20px;
            }

            .words-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 10px;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 15px;
            }

            .level-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .modal-content {
                padding: 30px 20px;
            }

            .filter-buttons {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <div class="nav-links">
                <a href="index.html" class="nav-link">üéÆ Play Game</a>
                <a href="home.html" class="nav-link">üè† Home</a>
            </div>
            <h1>üìö My Vocabulary Database</h1>
            <p class="description">Track your learning progress and review all discovered words with definitions and grammar explanations!</p>
            
            <div id="tierBadgeContainer" style="margin-top: 15px;">
            </div>
        </div>

        <div id="lifetimeProgressContainer"></div>

        <div id="upgradeBannerContainer"></div>

        <div id="premiumActionsContainer"></div>

        <div class="stats-section">
            <h2 style="color: #6aaa64; margin-bottom: 20px;">üéØ Learning Progress</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number" id="totalWords">0</span>
                    <div class="stat-label">Total Words</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalLevels">0</span>
                    <div class="stat-label">Levels Played</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="longestWord">-</span>
                    <div class="stat-label">Longest Word</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="vocabularyScore">0</span>
                    <div class="stat-label">Vocab Score</div>
                </div>
            </div>
        </div>

        <div id="wordCountInfoContainer"></div>

        <div class="search-section">
            <input type="text" id="searchInput" class="search-input" placeholder="üîç Search your vocabulary collection...">
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterByLength('all')">All Words</button>
                <button class="filter-btn" onclick="filterByLength('2')">2 Letters</button>
                <button class="filter-btn" onclick="filterByLength('3')">3 Letters</button>
                <button class="filter-btn" onclick="filterByLength('4')">4 Letters</button>
                <button class="filter-btn" onclick="filterByLength('5')">5 Letters</button>
                <button class="filter-btn" onclick="filterByLength('6')">6 Letters</button>
                <button class="filter-btn" onclick="filterByLength('7')">7 Letters</button>
            </div>
        </div>

        <div id="advancedFiltersContainer"></div>

        <div id="vocabularyContent">
            <div class="empty-state">
                <h3>üå± Start Building Your Vocabulary!</h3>
                <p>Your vocabulary database is empty. Start playing to discover and collect words!</p>
                <a href="index.html" class="start-playing-btn">üéÆ Start Playing</a>
            </div>
        </div>

        <div class="footer">
            <p style="text-align: center; margin-top: 40px; padding: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); color: #888;">
                <a href="https://buy.stripe.com/6oUeVe2rO4MV9b9f8M2wU03" target="_blank" style="text-decoration: none; color: #888;">Made by Yo ‚úå ü•ö</a>
            </p>
        </div>
    </div>

    <script>
        console.log('üìö Vocabulary Database Page - Track your learning progress!');
        
        const TierSystem = {
            TIERS: {
                FREE: {
                    name: 'free',
                    dailyCap: 20,
                    lifetimeCap: 500,
                    displayName: 'Free Tier'
                },
                PAID: {
                    name: 'paid',
                    dailyCap: 50,
                    lifetimeCap: 58535,
                    displayName: 'Premium'
                },
                LIFETIME: {
                    name: 'lifetime',
                    dailyCap: 50,
                    lifetimeCap: null,
                    displayName: 'Lifetime'
                }
            },
            STORAGE_KEY: 'wordGrindTierData',
            LEGACY_PROGRESS_KEY: 'wordleGrindProgress',
            
            getTierData() {
                try {
                    const data = localStorage.getItem(this.STORAGE_KEY);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('Error reading tier data:', error);
                    return null;
                }
            },
            
            getUserTier() {
                const tierData = this.getTierData();
                if (!tierData) return this.TIERS.FREE.name;
                return tierData.tier || this.TIERS.FREE.name;
            },
            
            getTierInfo() {
                const tierData = this.getTierData();
                if (!tierData) {
                    return {
                        tier: 'free',
                        displayName: 'Free Tier',
                        dailyWordCount: 0,
                        dailyCap: 20,
                        dailyRemaining: 20,
                        lifetimeWordCount: 0,
                        lifetimeCap: 500,
                        lifetimeRemaining: 500,
                        subscriptionExpiry: null
                    };
                }
                const tier = this.getUserTier();
                const tierConfig = Object.values(this.TIERS).find(t => t.name === tier);
                
                return {
                    tier: tier,
                    displayName: tierConfig.displayName,
                    dailyWordCount: tierData.dailyWordCount,
                    dailyCap: tierData.dailyCap,
                    dailyRemaining: Math.max(0, tierData.dailyCap - tierData.dailyWordCount),
                    lifetimeWordCount: tierData.lifetimeWordCount,
                    lifetimeCap: tierData.lifetimeCap,
                    lifetimeRemaining: tierData.lifetimeCap ? Math.max(0, tierData.lifetimeCap - tierData.lifetimeWordCount) : null,
                    subscriptionExpiry: tierData.subscriptionExpiry
                };
            }
        };

        // Educational grammar info
        const grammarInfo = {
            'noun': 'A word that names a person, place, thing, or idea (e.g., cat, house, love)',
            'verb': 'A word that describes an action, state, or occurrence (e.g., run, is, think)',
            'adjective': 'A word that describes or modifies a noun (e.g., big, beautiful, smart)',
            'adverb': 'A word that modifies a verb, adjective, or other adverb (e.g., quickly, very, often)',
            'preposition': 'A word that shows the relationship between a noun and other words (e.g., in, on, under)',
            'conjunction': 'A word that connects words, phrases, or clauses (e.g., and, but, or)',
            'pronoun': 'A word that replaces a noun (e.g., he, she, it, they)',
            'interjection': 'A word or phrase that expresses emotion or surprise (e.g., wow, oh, hey)',
            'article': 'A word that defines a noun as specific or unspecific (a, an, the)',
            'possessive adjective': 'A word that shows ownership (my, your, his, her, our, their)',
            'determiner': 'A word that introduces a noun and provides context (this, that, some, many)'
        };

        let allFoundWords = [];
        let filteredWords = [];
        let currentFilter = 'all';
        let currentSortMethod = 'default';
        let tierInfo = null;
        let wordNotes = {};
        
        const NOTES_STORAGE_KEY = 'wordGrindWordNotes';
        
        function loadWordNotes() {
            try {
                const notes = localStorage.getItem(NOTES_STORAGE_KEY);
                wordNotes = notes ? JSON.parse(notes) : {};
            } catch (error) {
                console.error('Error loading word notes:', error);
                wordNotes = {};
            }
        }
        
        function saveWordNotes() {
            try {
                localStorage.setItem(NOTES_STORAGE_KEY, JSON.stringify(wordNotes));
            } catch (error) {
                console.error('Error saving word notes:', error);
            }
        }
        
        function initializeTierUI() {
            tierInfo = TierSystem.getTierInfo();
            console.log('Tier Info:', tierInfo);
            
            displayTierBadge();
            displayLifetimeProgress();
            displayUpgradeBanner();
            displayPremiumActions();
            displayAdvancedFilters();
            displayWordCountInfo();
        }
        
        function displayTierBadge() {
            const container = document.getElementById('tierBadgeContainer');
            let icon = '';
            let tierClass = '';
            
            if (tierInfo.tier === 'lifetime') {
                icon = 'üèÜ';
                tierClass = 'lifetime';
            } else if (tierInfo.tier === 'paid') {
                icon = 'üíé';
                tierClass = 'paid';
            } else {
                icon = 'üÜì';
                tierClass = 'free';
            }
            
            container.innerHTML = `
                <div class="tier-badge ${tierClass}">
                    <span>${icon}</span>
                    <span>${tierInfo.displayName}</span>
                </div>
            `;
        }
        
        function displayLifetimeProgress() {
            if (tierInfo.tier === 'lifetime') {
                document.getElementById('lifetimeProgressContainer').innerHTML = '';
                return;
            }
            
            const targetWords = 58535;
            const currentWords = tierInfo.lifetimeWordCount;
            const percentage = Math.min(100, (currentWords / targetWords) * 100);
            
            const container = document.getElementById('lifetimeProgressContainer');
            container.innerHTML = `
                <div class="lifetime-progress">
                    <h3>üèÜ Progress to Lifetime Unlock</h3>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: ${percentage}%">
                            ${percentage.toFixed(1)}%
                        </div>
                    </div>
                    <p class="progress-text">${currentWords.toLocaleString()} / ${targetWords.toLocaleString()} words discovered</p>
                    <p class="progress-text" style="font-size: 0.9em; margin-top: 10px;">
                        ${(targetWords - currentWords).toLocaleString()} words until lifetime access!
                    </p>
                </div>
            `;
        }
        
        function displayUpgradeBanner() {
            const container = document.getElementById('upgradeBannerContainer');
            
            if (tierInfo.tier !== 'free') {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = `
                <div class="upgrade-banner">
                    <h3>üìö Unlock Your Complete Vocabulary History</h3>
                    <p>Free tier shows your last 100 discovered words. Upgrade to Premium for unlimited access to your full vocabulary journal with notes, export, and advanced search features.</p>
                    <a href="upgrade.html" class="upgrade-btn">‚ú® Upgrade to Premium - $1.50/month</a>
                </div>
            `;
        }
        
        function displayPremiumActions() {
            const container = document.getElementById('premiumActionsContainer');
            const isPremium = tierInfo.tier === 'paid' || tierInfo.tier === 'lifetime';
            
            if (!isPremium) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = `
                <div class="premium-actions">
                    <button class="premium-btn" onclick="exportToCSV()">
                        <span>üì•</span>
                        <span>Export to CSV</span>
                    </button>
                    <button class="premium-btn" onclick="toggleSortDropdown()">
                        <span>üìä</span>
                        <span>Advanced Sort</span>
                    </button>
                </div>
            `;
        }
        
        function displayWordCountInfo() {
            const container = document.getElementById('wordCountInfoContainer');
            const totalWords = allFoundWords.length;
            const displayedWords = filteredWords.length;
            const isFree = tierInfo.tier === 'free';
            
            let message = '';
            if (isFree && totalWords > 100) {
                message = `<div class="word-count-info">
                    Showing <span class="word-count-number">100</span> of <span class="word-count-number">${totalWords}</span> total words
                    <div style="margin-top: 10px; font-size: 0.9em; color: #d4a953;">
                        <a href="upgrade.html" style="color: #d4a953; text-decoration: underline;">Upgrade to Premium</a> to view all ${totalWords} words
                    </div>
                </div>`;
            } else if (displayedWords !== totalWords) {
                message = `<div class="word-count-info">
                    Showing <span class="word-count-number">${displayedWords}</span> of <span class="word-count-number">${totalWords}</span> words
                </div>`;
            }
            
            container.innerHTML = message;
        }
        
        function displayAdvancedFilters() {
            const container = document.getElementById('advancedFiltersContainer');
            const isPremium = tierInfo.tier === 'paid' || tierInfo.tier === 'lifetime';
            
            if (!isPremium) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = `
                <div class="advanced-filters">
                    <h4>üéØ Advanced Sorting</h4>
                    <div class="sort-options">
                        <button class="sort-btn ${currentSortMethod === 'default' ? 'active' : ''}" onclick="applySorting('default')">Default</button>
                        <button class="sort-btn ${currentSortMethod === 'alphabetical' ? 'active' : ''}" onclick="applySorting('alphabetical')">A-Z</button>
                        <button class="sort-btn ${currentSortMethod === 'reverse-alpha' ? 'active' : ''}" onclick="applySorting('reverse-alpha')">Z-A</button>
                        <button class="sort-btn ${currentSortMethod === 'shortest' ? 'active' : ''}" onclick="applySorting('shortest')">Shortest First</button>
                        <button class="sort-btn ${currentSortMethod === 'longest' ? 'active' : ''}" onclick="applySorting('longest')">Longest First</button>
                        <button class="sort-btn ${currentSortMethod === 'pos' ? 'active' : ''}" onclick="applySorting('pos')">By Part of Speech</button>
                    </div>
                </div>
            `;
        }

        function loadVocabularyData() {
            if (!tierInfo) {
                tierInfo = TierSystem.getTierInfo();
            }
            
            const gameProgressData = localStorage.getItem('wordleGrindProgress');
            
            if (!gameProgressData) {
                showEmptyState();
                return;
            }
            
            let foundWordsData;
            try {
                const progress = JSON.parse(gameProgressData);
                foundWordsData = progress.foundWords;
                if (!foundWordsData || Object.keys(foundWordsData).length === 0) {
                    showEmptyState();
                    return;
                }
            } catch (e) {
                console.error('Error parsing game progress:', e);
                showEmptyState();
                return;
            }

            try {
                const foundWords = foundWordsData;
                let wordsArray = [];

                for (const [length, words] of Object.entries(foundWords)) {
                    if (Array.isArray(words)) {
                        words.forEach(wordData => {
                            wordsArray.push({
                                ...wordData,
                                length: parseInt(length)
                            });
                        });
                    }
                }

                if (wordsArray.length === 0) {
                    showEmptyState();
                    return;
                }

                wordsArray.sort((a, b) => {
                    if (a.length !== b.length) {
                        return a.length - b.length;
                    }
                    return a.word.localeCompare(b.word);
                });

                const isFree = tierInfo.tier === 'free';
                if (isFree && wordsArray.length > 100) {
                    allFoundWords = wordsArray.slice(-100);
                    console.log(`Free tier: Showing last 100 of ${wordsArray.length} words`);
                } else {
                    allFoundWords = wordsArray;
                }

                updateStats();
                displayWordCountInfo();
                filterByLength(currentFilter);

            } catch (error) {
                console.error('Error loading vocabulary data:', error);
                showEmptyState();
            }
        }

        function showEmptyState() {
            document.getElementById('vocabularyContent').innerHTML = `
                <div class="empty-state">
                    <h3>üå± Start Building Your Vocabulary!</h3>
                    <p>Your vocabulary database is empty. Start playing to discover and collect words!</p>
                    <a href="index.html" class="start-playing-btn">üéÆ Start Playing</a>
                </div>
            `;
        }

        function updateStats() {
            const totalWords = allFoundWords.length;
            const levels = [...new Set(allFoundWords.map(w => w.length))];
            const longestWord = allFoundWords.reduce((longest, word) => 
                word.word.length > longest.length ? word.word : longest, 
                { length: 0 }).word || '-';
            const vocabularyScore = totalWords * 10; // Simple scoring system

            document.getElementById('totalWords').textContent = totalWords;
            document.getElementById('totalLevels').textContent = levels.length;
            document.getElementById('longestWord').textContent = longestWord.toUpperCase();
            document.getElementById('vocabularyScore').textContent = vocabularyScore;
        }

        function filterByLength(length) {
            currentFilter = length;
            
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event?.target?.classList.add('active');

            if (length === 'all') {
                filteredWords = [...allFoundWords];
            } else {
                filteredWords = allFoundWords.filter(word => word.length === parseInt(length));
            }

            displayVocabulary();
        }

        function displayVocabulary() {
            const content = document.getElementById('vocabularyContent');
            
            if (filteredWords.length === 0) {
                if (currentFilter === 'all') {
                    showEmptyState();
                } else {
                    content.innerHTML = `
                        <div class="empty-state">
                            <h3>üìñ No ${currentFilter}-Letter Words Yet</h3>
                            <p>Play the ${currentFilter}-letter level to start collecting words!</p>
                            <a href="index.html" class="start-playing-btn">üéÆ Start Playing</a>
                        </div>
                    `;
                }
                return;
            }

            // Group words by length
            const wordsByLength = {};
            filteredWords.forEach(word => {
                if (!wordsByLength[word.length]) {
                    wordsByLength[word.length] = [];
                }
                wordsByLength[word.length].push(word);
            });

            let html = '';
            for (const [length, words] of Object.entries(wordsByLength)) {
                html += `
                    <div class="level-section">
                        <div class="level-header">
                            <h3 class="level-title">${length}-Letter Words</h3>
                            <span class="level-count">${words.length} words</span>
                        </div>
                        <div class="words-grid">
                `;

                words.forEach(wordData => {
                    const displayPos = (wordData.pos && wordData.pos !== 'unknown') ? wordData.pos : '';
                    const isPremium = tierInfo.tier === 'paid' || tierInfo.tier === 'lifetime';
                    const wordNote = wordNotes[wordData.word.toLowerCase()];
                    
                    html += `
                        <div class="word-card" onclick="showWordDetails('${wordData.word}', '${wordData.definition.replace(/'/g, "\\'")}', '${wordData.pos}')">
                            <div class="word-text">${wordData.word}</div>
                            <div class="word-pos">${displayPos}</div>
                            <div class="word-definition">${wordData.definition.substring(0, 80)}${wordData.definition.length > 80 ? '...' : ''}</div>
                            ${wordNote ? `<div class="word-notes">üìù ${wordNote}</div>` : ''}
                            ${isPremium ? `<button class="add-note-btn" onclick="event.stopPropagation(); addWordNote('${wordData.word}')">${wordNote ? 'Edit' : 'Add'} Note</button>` : ''}
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            }

            content.innerHTML = html;
        }


        function exportToCSV() {
            const isPremium = tierInfo.tier === 'paid' || tierInfo.tier === 'lifetime';
            if (!isPremium) {
                alert('Export to CSV is a premium feature. Upgrade to access!');
                return;
            }
            
            let csvContent = 'Word,Part of Speech,Definition,Length,Notes\n';
            
            allFoundWords.forEach(wordData => {
                const word = wordData.word;
                const pos = wordData.pos || '';
                const definition = (wordData.definition || '').replace(/"/g, '""');
                const length = wordData.length;
                const note = (wordNotes[word.toLowerCase()] || '').replace(/"/g, '""');
                
                csvContent += `"${word}","${pos}","${definition}",${length},"${note}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `vocabulary_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function addWordNote(word) {
            const isPremium = tierInfo.tier === 'paid' || tierInfo.tier === 'lifetime';
            if (!isPremium) {
                alert('Adding notes is a premium feature. Upgrade to access!');
                return;
            }
            
            const currentNote = wordNotes[word.toLowerCase()] || '';
            const newNote = prompt(`Add a note for "${word.toUpperCase()}":`, currentNote);
            
            if (newNote !== null) {
                if (newNote.trim() === '') {
                    delete wordNotes[word.toLowerCase()];
                } else {
                    wordNotes[word.toLowerCase()] = newNote.trim();
                }
                saveWordNotes();
                displayVocabulary();
            }
        }
        
        function applySorting(method) {
            currentSortMethod = method;
            
            switch (method) {
                case 'alphabetical':
                    filteredWords.sort((a, b) => a.word.localeCompare(b.word));
                    break;
                case 'reverse-alpha':
                    filteredWords.sort((a, b) => b.word.localeCompare(a.word));
                    break;
                case 'shortest':
                    filteredWords.sort((a, b) => a.length - b.length || a.word.localeCompare(b.word));
                    break;
                case 'longest':
                    filteredWords.sort((a, b) => b.length - a.length || a.word.localeCompare(b.word));
                    break;
                case 'pos':
                    filteredWords.sort((a, b) => {
                        const posA = a.pos || 'zzz';
                        const posB = b.pos || 'zzz';
                        return posA.localeCompare(posB) || a.word.localeCompare(b.word);
                    });
                    break;
                default:
                    filteredWords.sort((a, b) => {
                        if (a.length !== b.length) {
                            return a.length - b.length;
                        }
                        return a.word.localeCompare(b.word);
                    });
            }
            
            displayAdvancedFilters();
            displayVocabulary();
        }

        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            if (searchTerm === '') {
                filteredWords = currentFilter === 'all' ? [...allFoundWords] : 
                    allFoundWords.filter(word => word.length === parseInt(currentFilter));
            } else {
                const baseWords = currentFilter === 'all' ? allFoundWords : 
                    allFoundWords.filter(word => word.length === parseInt(currentFilter));
                
                filteredWords = baseWords.filter(word => 
                    word.word.toLowerCase().includes(searchTerm) ||
                    word.definition.toLowerCase().includes(searchTerm) ||
                    word.pos.toLowerCase().includes(searchTerm)
                );
            }
            
            applySorting(currentSortMethod);
        });

        // Centralized Definition Service with caching, deduplication, and error handling
        class DefinitionService {
            constructor() {
                this.cache = new Map();
                this.persistentCache = this.loadFromStorage();
                this.inFlightRequests = new Map();
                this.retryDelays = [1000, 2000, 4000]; // Exponential backoff
                
                // Save cache every 10 seconds to preserve definitions
                setInterval(() => this.saveToStorage(), 10000);
            }

            loadFromStorage() {
                try {
                    const stored = localStorage.getItem('wordDefinitionsCache');
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        return new Map(parsed);
                    }
                } catch (error) {
                    console.error('Error loading definition cache:', error);
                }
                return new Map();
            }

            saveToStorage() {
                try {
                    const cacheArray = Array.from(this.persistentCache.entries());
                    localStorage.setItem('wordDefinitionsCache', JSON.stringify(cacheArray));
                } catch (error) {
                    console.error('Error saving definition cache:', error);
                }
            }

            async fetchFromAPI(word, retryCount = 0) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout

                    const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`, {
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }

                    const data = await response.json();
                    
                    if (data && data.length > 0 && data[0].meanings && data[0].meanings.length > 0) {
                        const meaning = data[0].meanings[0];
                        const partOfSpeech = meaning.partOfSpeech || 'unknown';
                        const definition = meaning.definitions && meaning.definitions[0] && meaning.definitions[0].definition;
                        
                        if (definition) {
                            const formattedDefinition = `(${partOfSpeech}) ${definition}`;
                            
                            // Cache both in memory and persistent storage
                            this.cache.set(word.toLowerCase(), formattedDefinition);
                            this.persistentCache.set(word.toLowerCase(), formattedDefinition);
                            this.saveToStorage();
                            
                            return formattedDefinition;
                        }
                    }
                    
                    throw new Error('No valid definition found');
                    
                } catch (error) {
                    if (retryCount < this.retryDelays.length) {
                        console.warn(`Definition fetch failed for "${word}", retrying in ${this.retryDelays[retryCount]}ms...`);
                        
                        await new Promise(resolve => setTimeout(resolve, this.retryDelays[retryCount]));
                        return this.fetchFromAPI(word, retryCount + 1);
                    }
                    
                    console.error(`Failed to fetch definition for "${word}" after ${retryCount + 1} attempts:`, error);
                    return this.getFallbackDefinition(word);
                }
            }

            getFallbackDefinition(word) {
                // Return a properly formatted fallback that won't confuse the parser
                return `(unknown) Definition not available for this word.`;
            }

            async getDefinition(word, showLoading = null) {
                if (!word) return this.getFallbackDefinition(word);

                const cacheKey = word.toLowerCase();
                
                // Check memory cache first
                if (this.cache.has(cacheKey)) {
                    return this.cache.get(cacheKey);
                }
                
                // Check persistent cache
                if (this.persistentCache.has(cacheKey)) {
                    const cachedDefinition = this.persistentCache.get(cacheKey);
                    this.cache.set(cacheKey, cachedDefinition); // Also store in memory cache
                    return cachedDefinition;
                }
                
                // Check if request is already in flight to avoid duplicates
                if (this.inFlightRequests.has(cacheKey)) {
                    return this.inFlightRequests.get(cacheKey);
                }
                
                // Make new request
                const requestPromise = this.fetchFromAPI(word);
                this.inFlightRequests.set(cacheKey, requestPromise);
                
                try {
                    const result = await requestPromise;
                    return result;
                } finally {
                    this.inFlightRequests.delete(cacheKey);
                }
            }

            async ensureWordHasDefinition(wordObj, showLoading = null) {
                if (wordObj.definition && 
                    !wordObj.definition.includes("definition not available") &&
                    !wordObj.definition.includes("Definition not available") &&
                    !wordObj.definition.includes("A valid English word")) {
                    return wordObj;
                }

                const definition = await this.getDefinition(wordObj.word, showLoading);
                return { ...wordObj, definition };
            }
        }

        // Initialize the definition service
        const definitionService = new DefinitionService();

        // Enhanced word details function with live definition fetching and premium features
        async function showWordDetails(word, definition, pos) {
            const isPremium = tierInfo.tier === 'paid' || tierInfo.tier === 'lifetime';
            
            const modal = document.createElement('div');
            modal.className = 'definition-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <div class="modal-word">
                        ${word}
                        ${isPremium ? `<button onclick="pronounceWord('${word}')" style="background: #6aaa64; border: none; color: white; padding: 8px 15px; border-radius: 5px; margin-left: 15px; cursor: pointer;">üîä Pronounce</button>` : ''}
                    </div>
                    <div class="modal-pos">${pos !== 'unknown' ? pos : ''}</div>
                    <div class="modal-definition">Loading definition...</div>
                    ${isPremium ? `
                        <div class="premium-word-info" style="margin-top: 20px;">
                            <div id="wordEtymology" style="display: none; background: rgba(106, 170, 100, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #6aaa64; margin-bottom: 10px;">üìñ Etymology</h4>
                                <p id="etymologyText" style="color: #ccc;"></p>
                            </div>
                            <div id="wordSynonyms" style="display: none; background: rgba(106, 170, 100, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #6aaa64; margin-bottom: 10px;">üîó Synonyms</h4>
                                <div id="synonymsList" style="color: #ccc;"></div>
                            </div>
                            <div id="wordExamples" style="display: none; background: rgba(106, 170, 100, 0.1); padding: 15px; border-radius: 8px;">
                                <h4 style="color: #6aaa64; margin-bottom: 10px;">üí¨ Usage Examples</h4>
                                <div id="examplesList" style="color: #ccc;"></div>
                            </div>
                        </div>
                    ` : ''}
                    <div class="grammar-explanation">
                        <h4>üìù Grammar Explanation</h4>
                        <p>${grammarInfo[pos] || 'This word is a valuable addition to your vocabulary!'}</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Fetch fresh definition and premium features if needed
            try {
                const wordObj = { word, definition, pos };
                const wordWithDef = await definitionService.ensureWordHasDefinition(wordObj);
                
                // Update the modal with fresh definition
                const definitionElement = modal.querySelector('.modal-definition');
                if (definitionElement) {
                    definitionElement.textContent = wordWithDef.definition;
                }
                
                // Fetch premium features if user has premium
                if (isPremium) {
                    await fetchPremiumWordInfo(word, modal);
                }
            } catch (error) {
                console.error('Error fetching definition:', error);
                const definitionElement = modal.querySelector('.modal-definition');
                if (definitionElement) {
                    definitionElement.textContent = definition || 'Definition not available';
                }
            }
            
            modal.onclick = (e) => {
                if (e.target === modal || e.target.className === 'close-modal') {
                    document.body.removeChild(modal);
                }
            };
        }
        
        // Fetch premium word information (etymology, synonyms, examples)
        async function fetchPremiumWordInfo(word, modal) {
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`);
                if (!response.ok) return;
                
                const data = await response.json();
                if (!data || !data[0]) return;
                
                const entry = data[0];
                
                // Etymology (if available)
                if (entry.etymologies && entry.etymologies.length > 0) {
                    const etymologyDiv = modal.querySelector('#wordEtymology');
                    const etymologyText = modal.querySelector('#etymologyText');
                    if (etymologyDiv && etymologyText) {
                        etymologyText.textContent = entry.etymologies[0];
                        etymologyDiv.style.display = 'block';
                    }
                }
                
                // Synonyms
                const synonyms = [];
                if (entry.meanings) {
                    entry.meanings.forEach(meaning => {
                        if (meaning.synonyms) {
                            synonyms.push(...meaning.synonyms);
                        }
                    });
                }
                if (synonyms.length > 0) {
                    const synonymsDiv = modal.querySelector('#wordSynonyms');
                    const synonymsList = modal.querySelector('#synonymsList');
                    if (synonymsDiv && synonymsList) {
                        const uniqueSynonyms = [...new Set(synonyms)].slice(0, 10);
                        synonymsList.innerHTML = uniqueSynonyms.map(syn => 
                            `<span style="background: rgba(106, 170, 100, 0.2); padding: 5px 10px; border-radius: 5px; margin: 5px; display: inline-block;">${syn}</span>`
                        ).join('');
                        synonymsDiv.style.display = 'block';
                    }
                }
                
                // Usage Examples
                const examples = [];
                if (entry.meanings) {
                    entry.meanings.forEach(meaning => {
                        if (meaning.definitions) {
                            meaning.definitions.forEach(def => {
                                if (def.example) {
                                    examples.push(def.example);
                                }
                            });
                        }
                    });
                }
                if (examples.length > 0) {
                    const examplesDiv = modal.querySelector('#wordExamples');
                    const examplesList = modal.querySelector('#examplesList');
                    if (examplesDiv && examplesList) {
                        examplesList.innerHTML = examples.slice(0, 3).map(example => 
                            `<p style="margin: 10px 0; font-style: italic; color: #aaa;">"${example}"</p>`
                        ).join('');
                        examplesDiv.style.display = 'block';
                    }
                }
            } catch (error) {
                console.error('Error fetching premium word info:', error);
            }
        }
        
        // Pronounce word function
        function pronounceWord(word) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                utterance.pitch = 1;
                window.speechSynthesis.speak(utterance);
            } else {
                alert('Speech synthesis not supported in your browser');
            }
        }

        loadWordNotes();
        initializeTierUI();
        loadVocabularyData();
        
        setInterval(() => {
            initializeTierUI();
            loadVocabularyData();
        }, 5000);
    </script>
</body>
</html>